<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Philéas Condemine" />


<title>Modélisation du Churn sur un petit échantillon par Gradient Boosting</title>

<script src="site_libs/header-attrs-2.6/header-attrs.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="site_libs/datatables-binding-0.17/datatables.js"></script>
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<script src="site_libs/plotly-binding-4.9.3/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotly-main-1.57.1/plotly-latest.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Basic use of Gradient Boosting on a small sample of Bank Churn Data</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Accueil</a>
</li>
<li>
  <a href="churn_gbm.html">Analyse</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Modélisation du Churn sur un petit échantillon par Gradient Boosting</h1>
<h4 class="author">Philéas Condemine</h4>
<h4 class="date">17/03/2021</h4>

</div>


<div id="chargement-des-packages" class="section level2">
<h2>Chargement des packages</h2>
<pre class="r"><code>library(data.table)
library(gbm)
library(caret)
library(dplyr)
library(MLmetrics)
library(plotly)
library(pdp)</code></pre>
</div>
<div id="lecture-des-données-et-consolidation" class="section level2">
<h2>Lecture des données et consolidation</h2>
<pre class="r"><code>customers = fread(&quot;data/customers.csv&quot;,encoding = &quot;UTF-8&quot;)
indicators = fread(&quot;data/indicators.csv&quot;,encoding = &quot;UTF-8&quot;)

uniqueN(indicators$ID_CLIENT)#On a 9950 individus avec 1 individu par ligne.</code></pre>
<pre><code>## [1] 9950</code></pre>
<pre class="r"><code>uniqueN(customers$ID_CLIENT)</code></pre>
<pre><code>## [1] 9950</code></pre>
<pre class="r"><code>dt = merge(customers,indicators,by=&quot;ID_CLIENT&quot;)
rm(customers,indicators)

dt = dt[,-c(&quot;ID_CLIENT&quot;,&quot;NOM&quot;)]
DT::datatable(head(dt,100)%&gt;%sapply(sample))#on permute les données par colonne parce que la diffusion n&#39;est pas autorisée. Ainsi on peut se faire une idée du contenu des colonnes sans révéler les données sous-jacentes.</code></pre>
<div id="htmlwidget-98a09c0bb372e2662754" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-98a09c0bb372e2662754">{"x":{"filter":"none","data":[["2019-02-01 00:00:00","2014-06-01 00:00:00","2017-01-01 00:00:00","2015-06-01 00:00:00","2020-03-01 00:00:00","2011-03-01 00:00:00","2020-04-01 00:00:00","2012-01-01 00:00:00","2012-05-01 00:00:00","2010-03-01 00:00:00","2016-05-01 00:00:00","2019-04-01 00:00:00","2019-01-01 00:00:00","2019-04-01 00:00:00","2017-02-01 00:00:00","2015-06-01 00:00:00","2014-06-01 00:00:00","2014-04-01 00:00:00","2015-01-01 00:00:00","2018-01-01 00:00:00","2012-02-01 00:00:00","2017-05-01 00:00:00","2010-06-01 00:00:00","2015-06-01 00:00:00","2020-05-01 00:00:00","2016-05-01 00:00:00","2014-04-01 00:00:00","2017-03-01 00:00:00","2015-06-01 00:00:00","2013-04-01 00:00:00","2013-06-01 00:00:00","2020-01-01 00:00:00","2018-04-01 00:00:00","2012-06-01 00:00:00","2019-01-01 00:00:00","2017-02-01 00:00:00","2016-03-01 00:00:00","2019-04-01 00:00:00","2012-02-01 00:00:00","2015-06-01 00:00:00","2019-01-01 00:00:00","2011-01-01 00:00:00","2017-03-01 00:00:00","2017-01-01 00:00:00","2012-06-01 00:00:00","2018-01-01 00:00:00","2014-05-01 00:00:00","2013-02-01 00:00:00","2011-06-01 00:00:00","2015-04-01 00:00:00","2014-01-01 00:00:00","2014-03-01 00:00:00","2016-01-01 00:00:00","2010-02-01 00:00:00","2012-01-01 00:00:00","2014-04-01 00:00:00","2018-04-01 00:00:00","2015-06-01 00:00:00","2013-01-01 00:00:00","2010-01-01 00:00:00","2018-04-01 00:00:00","2011-04-01 00:00:00","2011-02-01 00:00:00","2012-02-01 00:00:00","2013-05-01 00:00:00","2018-04-01 00:00:00","2011-04-01 00:00:00","2015-01-01 00:00:00","2016-05-01 00:00:00","2015-01-01 00:00:00","2012-01-01 00:00:00","2017-02-01 00:00:00","2010-04-01 00:00:00","2013-02-01 00:00:00","2017-04-01 00:00:00","2013-01-01 00:00:00","2018-03-01 00:00:00","2012-01-01 00:00:00","2017-04-01 00:00:00","2012-01-01 00:00:00","2018-03-01 00:00:00","2013-02-01 00:00:00","2013-05-01 00:00:00","2013-04-01 00:00:00","2011-01-01 00:00:00","2016-06-01 00:00:00","2013-03-01 00:00:00","2016-05-01 00:00:00","2013-02-01 00:00:00","2013-06-01 00:00:00","2019-06-01 00:00:00","2011-01-01 00:00:00","2016-06-01 00:00:00","2011-04-01 00:00:00","2012-06-01 00:00:00","2017-01-01 00:00:00","2018-03-01 00:00:00","2011-04-01 00:00:00","2014-04-01 00:00:00","2011-06-01 00:00:00"],["Allemagne","Allemagne","Espagne","France","France","Allemagne","Espagne","France","France","Allemagne","France","France","Allemagne","Espagne","Allemagne","France","Espagne","France","France","Allemagne","France","France","Espagne","Allemagne","Espagne","Espagne","France","France","France","Espagne","France","France","France","Allemagne","Allemagne","France","Espagne","France","Espagne","Allemagne","Allemagne","Espagne","France","Espagne","France","France","Allemagne","France","France","France","France","Espagne","Espagne","Espagne","Allemagne","Espagne","France","France","France","Espagne","France","Allemagne","France","France","Espagne","Espagne","Allemagne","Allemagne","France","Espagne","Allemagne","France","Allemagne","Allemagne","France","France","Allemagne","Allemagne","Espagne","France","Espagne","Allemagne","France","Allemagne","France","Allemagne","France","Allemagne","France","Allemagne","Allemagne","France","Allemagne","Espagne","Espagne","Allemagne","Espagne","Espagne","France","France"],["F","F","H","F","H","F","F","F","F","H","H","F","H","F","H","H","H","F","H","H","H","H","H","H","H","F","H","F","F","H","H","H","F","F","F","F","F","F","F","H","H","H","F","H","H","H","F","F","H","H","H","F","H","H","F","H","F","H","H","F","F","H","H","H","F","F","F","F","H","H","F","H","F","H","F","F","H","H","F","H","F","F","H","F","H","F","H","F","F","F","F","F","H","H","H","H","H","F","H","F"],["40","28","42","28","73","41","55","31","66","51","39","34","39","39","44","41","40","30","53","51","48","31","36","43","48","33","20","42","25","38","24","33","41","38","64","44","44","42","33","37","35","30","46","34","44","44","42","41","28","29","44","35","30","31","35","33","49","34","54","40","44","27","26","39","27","37","29","32","33","39","135","38","32","45","38","45","20","36","39","41","75","43","31","32","42","41","30","44","47","46","24","23","46","23","45","22","37","37","46","30"],["No","Yes","No","Yes","Yes","No","No","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","Yes","Yes","No","No","No","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","No","No","Yes","No","No","No","No","No","Yes","Yes","No","Yes","No","Yes","Yes","Yes","No","No","No","Yes","Yes","No","Yes","Yes","No","Yes","Yes","No","No","No","Yes","Yes","Yes","Yes","No","No","No","No","No","Yes","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","No","Yes","Yes","No","No","Yes","No","Yes","No","Yes","No"],["0","0","138053.79","133636.16","144164.29","96652.86","83739.32","0","0","0","0","53573.18","105918.1","0","0","96048.55","177997.07","189318.16","134874.4","0","167557.12","124616.23","100275.88","52016.08","143006.7","108913.84","0","129991.76","66201.96","141535.52","0","0","102630.13","80542.81","123040.38","114631.23","129387.94","0","0","71497.79","137851.31","0","0","81710.46","127320.36","0","0","88594.93","155059.1","139840.36","0","100727.5","98009.13","0","103560.57","118894.22","0","0","0","0","0","0","0","66948.67","119278.01","134766.85","128243.03","69609.85","0","109558.36","0","132725.1","114354.95","106434.94","111574.41","77168.87","0","138171.1","145578.28","144880.34","137817.52","0","163714.52","144027.8","0","88046.88","0","161993.89","0","124213.36","0","0","143391.07","0","71379.53","0","167735.69","57809.32","114940.67","64430.06"],["1","1","2","2","2","1","2","2","2","2","1","2","2","2","1","2","1","2","2","1","1","2","2","1","1","2","3","1","1","2","2","2","3","1","1","2","2","2","1","2","2","2","1","1","1","2","1","1","3","2","2","2","1","1","1","2","2","1","2","1","1","1","2","1","2","1","1","1","2","1","1","2","15","2","1","1","2","2","2","2","2","1","1","1","1","2","1","2","1","1","1","1","1","2","1","1","4","2","2","1"],["Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","No","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","Yes","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","Yes","No","Yes","No","Yes","No","Yes","Yes","No","No","No","No","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","No","No","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes"],["46041.08","41183.02","178997.89","35600.25","31384.86","69320.97","120250.58","66393.89","148779.41","154639.72","127433.47","11631.34","108731.02","197963.46","104665.79","189016.24","118825.56","164549.74","144584.29","186172.85","96123.72","151083.8","170333.38","54018.93","81908.09","149665.65","71709.12","129590.18","175643.44","48963.59","27862.58","147955.91","19233.41","83256.26","116520.07","113469.65","34948.77","72993.65","62627.55","15650.89","98686.4","183515.13","146891.07","186942.49","140460.01","74510.65","103315.74","47307.9","162697.93","88729.22","2923.61","79458.12","81602.02","140857.76","148798.45",null,"163170.32","6123.15","90212.38","146700.22","30838.51",null,"163524.7","39382.06","107124.17","137995.66","194895.57","72127.83","79355.87","175480.93","116747.62","91429.74","30583.95","56185.98","158646.46","190040.29","16246.59","122604.44","5008.23","77475.73","62830.97","94739.2","101039.53","161653.5","96517.97","45026.23","154000.99","76503.06","188258.49","114283.33","51711.57","140759.03","56214.09","1276.87","19370.73","50595.15","188203.58","30804.68","83997.79","236.45"],["532","681","587","738","515","508","735","630",null,"656","809","586","850","660","559","698","574","612",null,"712","633","653","634","580","545","481","683","661","758","802","793","749","444","709","709","789","650",null,"492","601","637","766","596","556","689","586","698","527","653","761","573","535","734","487","684",null,"601","678","667","757","537","616","569","488","631","794","646","690","670","550","623","581","627","584","739","592","787","745","779","704","598","777","554","719","828",null,"501","497","450","633","430","738","656","634","712","573","548","618","749","773"],["No","Yes","No","Yes","Yes","No","No","No","No","No","No","No","No","No","No","No","No","Yes","No","No","No","No","No","Yes","Yes","No","No","No","No","No","No","No","No","No","Yes","No","No","No","No","No","No","Yes","No","No","No","No","Yes","Yes","No","No","No","Yes","No","No","Yes","No","No","No","No","No","No","No","No","No","No","No","No","Yes","No","No","No","No","Yes","No","No","No","Yes","No","No","No","Yes","No","No","No","No","No","No","No","Yes","No","No","Yes","No","No","No","No","No","Yes","No","No"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>DATE_ENTREE<\/th>\n      <th>PAYS<\/th>\n      <th>SEXE<\/th>\n      <th>AGE<\/th>\n      <th>MEMBRE_ACTIF<\/th>\n      <th>BALANCE<\/th>\n      <th>NB_PRODUITS<\/th>\n      <th>CARTE_CREDIT<\/th>\n      <th>SALAIRE<\/th>\n      <th>SCORE_CREDIT<\/th>\n      <th>CHURN<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="data-prep-basique" class="section level2">
<h2>Data-prep basique</h2>
<pre class="r"><code>dt[,DATE_ENTREE:=as.Date(DATE_ENTREE)]
{ggplot(data=dt)+geom_bar(aes(x=year(DATE_ENTREE)))}%&gt;%ggplotly</code></pre>
<div id="htmlwidget-77743964b31b0c378c2a" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-77743964b31b0c378c2a">{"x":{"data":[{"orientation":"v","width":[0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091],"base":[0,0,0,0,0,0,0,0,0,0,0],"x":[2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020],"y":[488,978,1017,1023,964,1008,986,1006,1039,1030,411],"text":["count:  488<br />year(DATE_ENTREE): 2010","count:  978<br />year(DATE_ENTREE): 2011","count: 1017<br />year(DATE_ENTREE): 2012","count: 1023<br />year(DATE_ENTREE): 2013","count:  964<br />year(DATE_ENTREE): 2014","count: 1008<br />year(DATE_ENTREE): 2015","count:  986<br />year(DATE_ENTREE): 2016","count: 1006<br />year(DATE_ENTREE): 2017","count: 1039<br />year(DATE_ENTREE): 2018","count: 1030<br />year(DATE_ENTREE): 2019","count:  411<br />year(DATE_ENTREE): 2020"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":48.9497716894977},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[2009.005,2020.995],"tickmode":"array","ticktext":["2010.0","2012.5","2015.0","2017.5","2020.0"],"tickvals":[2010,2012.5,2015,2017.5,2020],"categoryorder":"array","categoryarray":["2010.0","2012.5","2015.0","2017.5","2020.0"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"year(DATE_ENTREE)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-51.95,1090.95],"tickmode":"array","ticktext":["0","250","500","750","1000"],"tickvals":[0,250,500,750,1000],"categoryorder":"array","categoryarray":["0","250","500","750","1000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"42ac29554098":{"x":{},"type":"bar"}},"cur_data":"42ac29554098","visdat":{"42ac29554098":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>dt[,age_produit:=as.numeric(Sys.Date() - DATE_ENTREE)]

dt = dt[,-c(&quot;DATE_ENTREE&quot;)]
dt[,id:=1:nrow(dt)]
dt[,group:=sample(1:10,replace=T,nrow(dt))]
dt[,CHURN:=ifelse(CHURN==&quot;Yes&quot;,1,0)]
dt = dt%&gt;%mutate_if(is.character,factor)%&gt;%data.table
#vars not needed in the model
useless = c(&quot;id&quot;,&quot;group&quot;)</code></pre>
</div>
<div id="anticipation-définition-des-variables-ayant-un-effet-monotone" class="section level2">
<h2>Anticipation : définition des variables ayant un effet monotone</h2>
<p>On verra après avoir lancé le modèle, en affichant les courbes de dépendance partielle que l’effet salaire est faible et instable avec un risque d’overfitting, ça se passe mieux si on met une contrainte de croissance.</p>
<pre class="r"><code>vars = names(dt)
vars = setdiff(vars,&quot;CHURN&quot;)
vars = setdiff(vars,useless)
monotony = setNames(rep(0,length(vars)),vars)
monotony[&#39;SALAIRE&#39;]=1
monotony</code></pre>
<pre><code>##         PAYS         SEXE          AGE MEMBRE_ACTIF 
##            0            0            0            0 
##      BALANCE  NB_PRODUITS CARTE_CREDIT      SALAIRE 
##            0            0            0            1 
## SCORE_CREDIT  age_produit 
##            0            0</code></pre>
</div>
<div id="fonction-pour-lancer-le-modèle-sur-un-échantillon-90-10" class="section level2">
<h2>Fonction pour lancer le modèle sur un échantillon 90-10</h2>
<pre class="r"><code>run_model_one_fold_and_predict = function(my_group,params,monotony){
  train = dt[!group %in% my_group]
  test = dt[group %in% my_group]
  
  model = gbm(data = train[,-useless,with=F],CHURN~.,
              distribution = &quot;bernoulli&quot;,
              var.monotone = monotony,
              n.trees = params[&#39;ntrees&#39;],verbose = F,
              train.fraction = .7,
              interaction.depth = params[&quot;depth&quot;],
              n.minobsinnode = params[&quot;nobs_in_node&quot;],
              shrinkage = params[&#39;shrinkage&#39;]
  )
  best.iter &lt;- suppressMessages({gbm.perf(model, method = &quot;OOB&quot;,plot.it = F,oobag.curve = F,overlay = F)})
  # print(as.numeric(best.iter))
  pred = predict(model,test,type=&quot;response&quot;,n.trees = best.iter)
  quantile(pred,0:10/10)
  q80 = quantile(pred,.8)%&gt;%unname
  test$pred_prob = pred
  test$pred_val = 1*(pred &gt; q80)
  
  test
}</code></pre>
</div>
<div id="fonction-pour-lancer-10-modèles-et-calculer-les-métriques" class="section level2">
<h2>Fonction pour lancer 10 modèles et calculer les métriques</h2>
<pre class="r"><code>run_model_and_evaluate = function(params,monotony){
  res = lapply(1:10,run_model_one_fold_and_predict,params=params,monotony=monotony)
  res = rbindlist(res)
  precision = Precision(y_pred = res$pred_val,y_true = res$CHURN)
  acc = Accuracy(y_pred = res$pred_val,y_true = res$CHURN)
  recall = Recall(y_pred = res$pred_val,y_true = res$CHURN)
  auroc = MLmetrics::AUC(y_pred = res$pred_prob,y_true = res$CHURN)
  c(params,&quot;precision&quot;=precision,&quot;recall&quot;=recall,&quot;acc&quot;=acc,&quot;auroc&quot;=auroc)
}</code></pre>
</div>
<div id="quelques-jeux-de-paramètres" class="section level2">
<h2>Quelques jeux de paramètres</h2>
<div id="sans-contrainte-de-monotonie" class="section level3">
<h3>Sans contrainte de monotonie</h3>
<pre class="r"><code>monotony[&#39;SALAIRE&#39;]=0
params = c(&quot;depth&quot;=1,&quot;nobs_in_node&quot;=20,&quot;shrinkage&quot;=.1,&quot;ntrees&quot;=200)
run_model_and_evaluate(params,monotony)</code></pre>
<pre><code>##        depth nobs_in_node    shrinkage       ntrees 
##    1.0000000   20.0000000    0.1000000  200.0000000 
##    precision       recall          acc        auroc 
##    0.8960794    0.9000379    0.8372864    0.8449470</code></pre>
</div>
<div id="effet-croissant-du-salaire" class="section level3">
<h3>Effet croissant du salaire</h3>
<pre class="r"><code>monotony[&#39;SALAIRE&#39;]=1
params = c(&quot;depth&quot;=1,&quot;nobs_in_node&quot;=20,&quot;shrinkage&quot;=.1,&quot;ntrees&quot;=200)
run_model_and_evaluate(params,monotony)</code></pre>
<pre><code>##        depth nobs_in_node    shrinkage       ntrees 
##    1.0000000   20.0000000    0.1000000  200.0000000 
##    precision       recall          acc        auroc 
##    0.8962051    0.9001641    0.8374874    0.8452911</code></pre>
</div>
<div id="profondeur-2" class="section level3">
<h3>Profondeur 2</h3>
<pre class="r"><code>params = c(&quot;depth&quot;=2,&quot;nobs_in_node&quot;=10,&quot;shrinkage&quot;=.1,&quot;ntrees&quot;=200)
run_model_and_evaluate(params,monotony)</code></pre>
<pre><code>##        depth nobs_in_node    shrinkage       ntrees 
##    2.0000000   10.0000000    0.1000000  200.0000000 
##    precision       recall          acc        auroc 
##    0.8996983    0.9034457    0.8429146    0.8583950</code></pre>
</div>
<div id="profondeur-4" class="section level3">
<h3>Profondeur 4</h3>
<pre class="r"><code>params = c(&quot;depth&quot;=4,&quot;nobs_in_node&quot;=10,&quot;shrinkage&quot;=.1,&quot;ntrees&quot;=200)
run_model_and_evaluate(params,monotony)</code></pre>
<pre><code>##        depth nobs_in_node    shrinkage       ntrees 
##    4.0000000   10.0000000    0.1000000  200.0000000 
##    precision       recall          acc        auroc 
##    0.9020865    0.9058437    0.8467337    0.8617485</code></pre>
</div>
</div>
<div id="interprétation" class="section level2">
<h2>Interprétation</h2>
<div id="modèle-sur-toutes-les-données" class="section level3">
<h3>Modèle sur toutes les données</h3>
<pre class="r"><code>params = c(&quot;depth&quot;=1,&quot;nobs_in_node&quot;=20,&quot;shrinkage&quot;=.1,&quot;ntrees&quot;=200)
useless = c(&quot;id&quot;,&quot;group&quot;)
train = dt[,-useless,with=F]


model = gbm(data = train,CHURN~.,
            distribution = &quot;bernoulli&quot;,
            var.monotone = monotony,
            n.trees = params[&#39;ntrees&#39;],verbose = F,
            train.fraction = .7,
            interaction.depth = params[&quot;depth&quot;],
            n.minobsinnode = params[&quot;nobs_in_node&quot;],
            shrinkage = params[&#39;shrinkage&#39;]
)
best.iter &lt;- suppressMessages({gbm.perf(model, method = &quot;OOB&quot;,plot.it = F,oobag.curve = F,overlay = F)})
# best.iter</code></pre>
</div>
<div id="importance-des-variables" class="section level3">
<h3>Importance des variables</h3>
<pre class="r"><code>summary(model)</code></pre>
<p><img src="churn_gbm_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre><code>##                       var    rel.inf
## AGE                   AGE 44.3911160
## NB_PRODUITS   NB_PRODUITS 31.5849418
## MEMBRE_ACTIF MEMBRE_ACTIF  8.1475489
## PAYS                 PAYS  7.0596489
## SEXE                 SEXE  2.7453080
## BALANCE           BALANCE  2.3670145
## SCORE_CREDIT SCORE_CREDIT  1.7449830
## SALAIRE           SALAIRE  1.5599538
## age_produit   age_produit  0.3994851
## CARTE_CREDIT CARTE_CREDIT  0.0000000</code></pre>
</div>
</div>
<div id="dépendances-partielles" class="section level2">
<h2>Dépendances partielles</h2>
<p>L’examen des dépendances partielles est utile pour évaluer visuellement des risques d’overfitting.</p>
<div id="variables-numériques" class="section level3">
<h3>Variables numériques</h3>
<pre class="r"><code>pdply = function(varname){
  pdp &lt;- suppressWarnings({partial(model,varname,n.trees = best.iter,plot = T,plot.engine = &quot;ggplot2&quot;)})
  pdp %&gt;% ggplotly
}


pdply(&quot;AGE&quot;)</code></pre>
<pre><code>## Warning: Use of `object[[1L]]` is discouraged. Use
## `.data[[1L]]` instead.</code></pre>
<pre><code>## Warning: Use of `object[[&quot;yhat&quot;]]` is discouraged. Use
## `.data[[&quot;yhat&quot;]]` instead.</code></pre>
<div id="htmlwidget-235c5bccaea0be7e9e76" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-235c5bccaea0be7e9e76">{"x":{"data":[{"x":[18,20,23,26,29,32,35,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83,86,89,92,94,97,100,103,106,109,112,115,118,121,124,127,130,133,136,139,142,145,148,151,154,157,160,163,166],"y":[-1.22115117797725,-1.22115117797725,-1.22115117797725,-1.22115117797725,-1.22115117797725,-1.20164264809599,-1.06351798984914,-1.03837432943239,-0.875405891888118,-0.502666600178295,-0.19472911346336,-0.0871219086206848,-0.0871219086206848,-0.0871219086206848,-0.0871219086206848,-0.203777887206414,-0.363976539128758,-0.476080228228849,-0.599144038447424,-0.931201109518388,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604,-1.03475982318604],"text":["object[[1L]]:  18<br />object[[\"yhat\"]]: -1.22115118","object[[1L]]:  20<br />object[[\"yhat\"]]: -1.22115118","object[[1L]]:  23<br />object[[\"yhat\"]]: -1.22115118","object[[1L]]:  26<br />object[[\"yhat\"]]: -1.22115118","object[[1L]]:  29<br />object[[\"yhat\"]]: -1.22115118","object[[1L]]:  32<br />object[[\"yhat\"]]: -1.20164265","object[[1L]]:  35<br />object[[\"yhat\"]]: -1.06351799","object[[1L]]:  38<br />object[[\"yhat\"]]: -1.03837433","object[[1L]]:  41<br />object[[\"yhat\"]]: -0.87540589","object[[1L]]:  44<br />object[[\"yhat\"]]: -0.50266660","object[[1L]]:  47<br />object[[\"yhat\"]]: -0.19472911","object[[1L]]:  50<br />object[[\"yhat\"]]: -0.08712191","object[[1L]]:  53<br />object[[\"yhat\"]]: -0.08712191","object[[1L]]:  56<br />object[[\"yhat\"]]: -0.08712191","object[[1L]]:  59<br />object[[\"yhat\"]]: -0.08712191","object[[1L]]:  62<br />object[[\"yhat\"]]: -0.20377789","object[[1L]]:  65<br />object[[\"yhat\"]]: -0.36397654","object[[1L]]:  68<br />object[[\"yhat\"]]: -0.47608023","object[[1L]]:  71<br />object[[\"yhat\"]]: -0.59914404","object[[1L]]:  74<br />object[[\"yhat\"]]: -0.93120111","object[[1L]]:  77<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]:  80<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]:  83<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]:  86<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]:  89<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]:  92<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]:  94<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]:  97<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 100<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 103<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 106<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 109<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 112<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 115<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 118<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 121<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 124<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 127<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 130<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 133<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 136<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 139<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 142<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 145<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 148<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 151<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 154<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 157<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 160<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 163<br />object[[\"yhat\"]]: -1.03475982","object[[1L]]: 166<br />object[[\"yhat\"]]: -1.03475982"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":54.7945205479452},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[10.6,173.4],"tickmode":"array","ticktext":["40","80","120","160"],"tickvals":[40,80,120,160],"categoryorder":"array","categoryarray":["40","80","120","160"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"AGE","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.27785264144508,-0.0304204451528564],"tickmode":"array","ticktext":["-1.25","-1.00","-0.75","-0.50","-0.25"],"tickvals":[-1.25,-1,-0.75,-0.5,-0.25],"categoryorder":"array","categoryarray":["-1.25","-1.00","-0.75","-0.50","-0.25"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"yhat","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"42ac593472cb":{"x":{},"y":{},"type":"scatter"}},"cur_data":"42ac593472cb","visdat":{"42ac593472cb":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>pdply(&quot;BALANCE&quot;)</code></pre>
<pre><code>## Warning: Use of `object[[1L]]` is discouraged. Use
## `.data[[1L]]` instead.

## Warning: Use of `object[[&quot;yhat&quot;]]` is discouraged. Use
## `.data[[&quot;yhat&quot;]]` instead.</code></pre>
<div id="htmlwidget-873b888a3704f36452eb" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-873b888a3704f36452eb">{"x":{"data":[{"x":[0,5017.9618,10035.9236,15053.8854,20071.8472,25089.809,30107.7708,35125.7326,40143.6944,45161.6562,50179.618,55197.5798,60215.5416,65233.5034,70251.4652,75269.427,80287.3888,85305.3506,90323.3124,95341.2742,100359.236,105377.1978,110395.1596,115413.1214,120431.0832,125449.045,130467.0068,135484.9686,140502.9304,145520.8922,150538.854,155556.8158,160574.7776,165592.7394,170610.7012,175628.663,180646.6248,185664.5866,190682.5484,195700.5102,200718.472,205736.4338,210754.3956,215772.3574,220790.3192,225808.281,230826.2428,235844.2046,240862.1664,245880.1282,250898.09],"y":[-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.868355443531815,-0.852294943154835,-0.842116379489338,-0.842116379489338,-0.842116379489338,-0.842116379489338,-0.842116379489338,-0.842116379489338,-0.882782517049043,-0.882782517049043,-0.882782517049043,-0.882782517049043,-0.882782517049043,-0.882782517049043,-0.882782517049043,-0.882782517049043,-0.841254653846031,-0.841254653846031,-0.64517857822478,-0.327494523855311,-0.327494523855311,-0.327494523855311,-0.327494523855311,-0.327494523855311,-0.327494523855311,-0.327494523855311,-0.327494523855311,-0.327494523855311,-0.327494523855311,-0.327494523855311,-0.327494523855311],"text":["object[[1L]]:      0.000<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:   5017.962<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  10035.924<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  15053.885<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  20071.847<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  25089.809<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  30107.771<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  35125.733<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  40143.694<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  45161.656<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  50179.618<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  55197.580<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  60215.542<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  65233.503<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  70251.465<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  75269.427<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  80287.389<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  85305.351<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  90323.312<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]:  95341.274<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]: 100359.236<br />object[[\"yhat\"]]: -0.8683554","object[[1L]]: 105377.198<br />object[[\"yhat\"]]: -0.8522949","object[[1L]]: 110395.160<br />object[[\"yhat\"]]: -0.8421164","object[[1L]]: 115413.121<br />object[[\"yhat\"]]: -0.8421164","object[[1L]]: 120431.083<br />object[[\"yhat\"]]: -0.8421164","object[[1L]]: 125449.045<br />object[[\"yhat\"]]: -0.8421164","object[[1L]]: 130467.007<br />object[[\"yhat\"]]: -0.8421164","object[[1L]]: 135484.969<br />object[[\"yhat\"]]: -0.8421164","object[[1L]]: 140502.930<br />object[[\"yhat\"]]: -0.8827825","object[[1L]]: 145520.892<br />object[[\"yhat\"]]: -0.8827825","object[[1L]]: 150538.854<br />object[[\"yhat\"]]: -0.8827825","object[[1L]]: 155556.816<br />object[[\"yhat\"]]: -0.8827825","object[[1L]]: 160574.778<br />object[[\"yhat\"]]: -0.8827825","object[[1L]]: 165592.739<br />object[[\"yhat\"]]: -0.8827825","object[[1L]]: 170610.701<br />object[[\"yhat\"]]: -0.8827825","object[[1L]]: 175628.663<br />object[[\"yhat\"]]: -0.8827825","object[[1L]]: 180646.625<br />object[[\"yhat\"]]: -0.8412547","object[[1L]]: 185664.587<br />object[[\"yhat\"]]: -0.8412547","object[[1L]]: 190682.548<br />object[[\"yhat\"]]: -0.6451786","object[[1L]]: 195700.510<br />object[[\"yhat\"]]: -0.3274945","object[[1L]]: 200718.472<br />object[[\"yhat\"]]: -0.3274945","object[[1L]]: 205736.434<br />object[[\"yhat\"]]: -0.3274945","object[[1L]]: 210754.396<br />object[[\"yhat\"]]: -0.3274945","object[[1L]]: 215772.357<br />object[[\"yhat\"]]: -0.3274945","object[[1L]]: 220790.319<br />object[[\"yhat\"]]: -0.3274945","object[[1L]]: 225808.281<br />object[[\"yhat\"]]: -0.3274945","object[[1L]]: 230826.243<br />object[[\"yhat\"]]: -0.3274945","object[[1L]]: 235844.205<br />object[[\"yhat\"]]: -0.3274945","object[[1L]]: 240862.166<br />object[[\"yhat\"]]: -0.3274945","object[[1L]]: 245880.128<br />object[[\"yhat\"]]: -0.3274945","object[[1L]]: 250898.090<br />object[[\"yhat\"]]: -0.3274945"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":48.9497716894977},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-12544.9045,263442.9945],"tickmode":"array","ticktext":["0","50000","100000","150000","200000","250000"],"tickvals":[0,50000,100000,150000,200000,250000],"categoryorder":"array","categoryarray":["0","50000","100000","150000","200000","250000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"BALANCE","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.91054691670873,-0.299730124195625],"tickmode":"array","ticktext":["-0.9","-0.8","-0.7","-0.6","-0.5","-0.4","-0.3"],"tickvals":[-0.9,-0.8,-0.7,-0.6,-0.5,-0.4,-0.3],"categoryorder":"array","categoryarray":["-0.9","-0.8","-0.7","-0.6","-0.5","-0.4","-0.3"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"yhat","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"42ac104744e2":{"x":{},"y":{},"type":"scatter"}},"cur_data":"42ac104744e2","visdat":{"42ac104744e2":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>pdply(&quot;SALAIRE&quot;)</code></pre>
<pre><code>## Warning: Use of `object[[1L]]` is discouraged. Use
## `.data[[1L]]` instead.

## Warning: Use of `object[[&quot;yhat&quot;]]` is discouraged. Use
## `.data[[&quot;yhat&quot;]]` instead.</code></pre>
<div id="htmlwidget-3b012d4b686d99193134" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-3b012d4b686d99193134">{"x":{"data":[{"x":[11.58,4011.198,8010.816,12010.434,16010.052,20009.67,24009.288,28008.906,32008.524,36008.142,40007.76,44007.378,48006.996,52006.614,56006.232,60005.85,64005.468,68005.086,72004.704,76004.322,80003.94,84003.558,88003.176,92002.794,96002.412,100002.03,104001.648,108001.266,112000.884,116000.502,120000.12,123999.738,127999.356,131998.974,135998.592,139998.21,143997.828,147997.446,151997.064,155996.682,159996.3,163995.918,167995.536,171995.154,175994.772,179994.39,183994.008,187993.626,191993.244,195992.862,199992.48],"y":[-0.927374874941685,-0.904032649011626,-0.875900490989702,-0.875900490989702,-0.875900490989702,-0.875900490989702,-0.875900490989702,-0.875900490989702,-0.875900490989702,-0.875900490989702,-0.875900490989702,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.867096032670134,-0.860830227410971,-0.853954207083286,-0.853954207083286,-0.853954207083286,-0.853954207083286,-0.853954207083286,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.844420476381333,-0.835985207177936,-0.835985207177936,-0.835985207177936],"text":["object[[1L]]:     11.580<br />object[[\"yhat\"]]: -0.9273749","object[[1L]]:   4011.198<br />object[[\"yhat\"]]: -0.9040326","object[[1L]]:   8010.816<br />object[[\"yhat\"]]: -0.8759005","object[[1L]]:  12010.434<br />object[[\"yhat\"]]: -0.8759005","object[[1L]]:  16010.052<br />object[[\"yhat\"]]: -0.8759005","object[[1L]]:  20009.670<br />object[[\"yhat\"]]: -0.8759005","object[[1L]]:  24009.288<br />object[[\"yhat\"]]: -0.8759005","object[[1L]]:  28008.906<br />object[[\"yhat\"]]: -0.8759005","object[[1L]]:  32008.524<br />object[[\"yhat\"]]: -0.8759005","object[[1L]]:  36008.142<br />object[[\"yhat\"]]: -0.8759005","object[[1L]]:  40007.760<br />object[[\"yhat\"]]: -0.8759005","object[[1L]]:  44007.378<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  48006.996<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  52006.614<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  56006.232<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  60005.850<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  64005.468<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  68005.086<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  72004.704<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  76004.322<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  80003.940<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  84003.558<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  88003.176<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  92002.794<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]:  96002.412<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]: 100002.030<br />object[[\"yhat\"]]: -0.8670960","object[[1L]]: 104001.648<br />object[[\"yhat\"]]: -0.8608302","object[[1L]]: 108001.266<br />object[[\"yhat\"]]: -0.8539542","object[[1L]]: 112000.884<br />object[[\"yhat\"]]: -0.8539542","object[[1L]]: 116000.502<br />object[[\"yhat\"]]: -0.8539542","object[[1L]]: 120000.120<br />object[[\"yhat\"]]: -0.8539542","object[[1L]]: 123999.738<br />object[[\"yhat\"]]: -0.8539542","object[[1L]]: 127999.356<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 131998.974<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 135998.592<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 139998.210<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 143997.828<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 147997.446<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 151997.064<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 155996.682<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 159996.300<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 163995.918<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 167995.536<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 171995.154<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 175994.772<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 179994.390<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 183994.008<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 187993.626<br />object[[\"yhat\"]]: -0.8444205","object[[1L]]: 191993.244<br />object[[\"yhat\"]]: -0.8359852","object[[1L]]: 195992.862<br />object[[\"yhat\"]]: -0.8359852","object[[1L]]: 199992.480<br />object[[\"yhat\"]]: -0.8359852"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":60.6392694063927},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-9987.465,209991.525],"tickmode":"array","ticktext":["0","50000","100000","150000","200000"],"tickvals":[0,50000,100000,150000,200000],"categoryorder":"array","categoryarray":["0","50000","100000","150000","200000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"SALAIRE","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.931944358329873,-0.831415723789748],"tickmode":"array","ticktext":["-0.925","-0.900","-0.875","-0.850"],"tickvals":[-0.925,-0.9,-0.875,-0.85],"categoryorder":"array","categoryarray":["-0.925","-0.900","-0.875","-0.850"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"yhat","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"42ac426918d6":{"x":{},"y":{},"type":"scatter"}},"cur_data":"42ac426918d6","visdat":{"42ac426918d6":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>pdply(&quot;SCORE_CREDIT&quot;)</code></pre>
<pre><code>## Warning: Use of `object[[1L]]` is discouraged. Use
## `.data[[1L]]` instead.

## Warning: Use of `object[[&quot;yhat&quot;]]` is discouraged. Use
## `.data[[&quot;yhat&quot;]]` instead.</code></pre>
<div id="htmlwidget-396cfff3bc39031e27c9" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-396cfff3bc39031e27c9">{"x":{"data":[{"x":[350,360,370,380,390,400,410,420,430,440,450,460,470,480,490,500,510,520,530,540,550,560,570,580,590,600,610,620,630,640,650,660,670,680,690,700,710,720,730,740,750,760,770,780,790,800,810,820,830,840,850],"y":[-0.470386582869043,-0.470386582869043,-0.470386582869043,-0.470386582869043,-0.470386582869043,-0.470386582869043,-0.470386582869043,-0.593005189945686,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.851366139835513,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.86959785346139,-0.854784380976257,-0.854784380976257,-0.854784380976257,-0.854784380976257,-0.854784380976257,-0.854784380976257,-0.854784380976257,-0.854784380976257,-0.854784380976257,-0.854784380976257,-0.854784380976257,-0.854784380976257],"text":["object[[1L]]: 350<br />object[[\"yhat\"]]: -0.4703866","object[[1L]]: 360<br />object[[\"yhat\"]]: -0.4703866","object[[1L]]: 370<br />object[[\"yhat\"]]: -0.4703866","object[[1L]]: 380<br />object[[\"yhat\"]]: -0.4703866","object[[1L]]: 390<br />object[[\"yhat\"]]: -0.4703866","object[[1L]]: 400<br />object[[\"yhat\"]]: -0.4703866","object[[1L]]: 410<br />object[[\"yhat\"]]: -0.4703866","object[[1L]]: 420<br />object[[\"yhat\"]]: -0.5930052","object[[1L]]: 430<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 440<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 450<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 460<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 470<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 480<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 490<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 500<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 510<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 520<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 530<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 540<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 550<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 560<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 570<br />object[[\"yhat\"]]: -0.8513661","object[[1L]]: 580<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 590<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 600<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 610<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 620<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 630<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 640<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 650<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 660<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 670<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 680<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 690<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 700<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 710<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 720<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 730<br />object[[\"yhat\"]]: -0.8695979","object[[1L]]: 740<br />object[[\"yhat\"]]: -0.8547844","object[[1L]]: 750<br />object[[\"yhat\"]]: -0.8547844","object[[1L]]: 760<br />object[[\"yhat\"]]: -0.8547844","object[[1L]]: 770<br />object[[\"yhat\"]]: -0.8547844","object[[1L]]: 780<br />object[[\"yhat\"]]: -0.8547844","object[[1L]]: 790<br />object[[\"yhat\"]]: -0.8547844","object[[1L]]: 800<br />object[[\"yhat\"]]: -0.8547844","object[[1L]]: 810<br />object[[\"yhat\"]]: -0.8547844","object[[1L]]: 820<br />object[[\"yhat\"]]: -0.8547844","object[[1L]]: 830<br />object[[\"yhat\"]]: -0.8547844","object[[1L]]: 840<br />object[[\"yhat\"]]: -0.8547844","object[[1L]]: 850<br />object[[\"yhat\"]]: -0.8547844"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":48.9497716894977},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[325,875],"tickmode":"array","ticktext":["400","500","600","700","800"],"tickvals":[400,500,600,700,800],"categoryorder":"array","categoryarray":["400","500","600","700","800"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"SCORE_CREDIT","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.889558416991007,-0.450426019339426],"tickmode":"array","ticktext":["-0.8","-0.7","-0.6","-0.5"],"tickvals":[-0.8,-0.7,-0.6,-0.5],"categoryorder":"array","categoryarray":["-0.8","-0.7","-0.6","-0.5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"yhat","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"42ac1faa4d74":{"x":{},"y":{},"type":"scatter"}},"cur_data":"42ac1faa4d74","visdat":{"42ac1faa4d74":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>pdply(&quot;age_produit&quot;)</code></pre>
<pre><code>## Warning: Use of `object[[1L]]` is discouraged. Use
## `.data[[1L]]` instead.

## Warning: Use of `object[[&quot;yhat&quot;]]` is discouraged. Use
## `.data[[&quot;yhat&quot;]]` instead.</code></pre>
<div id="htmlwidget-50b1fc28ce118ec314d6" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-50b1fc28ce118ec314d6">{"x":{"data":[{"x":[289,365.08,441.16,517.24,593.32,669.4,745.48,821.56,897.64,973.72,1049.8,1125.88,1201.96,1278.04,1354.12,1430.2,1506.28,1582.36,1658.44,1734.52,1810.6,1886.68,1962.76,2038.84,2114.92,2191,2267.08,2343.16,2419.24,2495.32,2571.4,2647.48,2723.56,2799.64,2875.72,2951.8,3027.88,3103.96,3180.04,3256.12,3332.2,3408.28,3484.36,3560.44,3636.52,3712.6,3788.68,3864.76,3940.84,4016.92,4093],"y":[-0.8072063012321,-0.8072063012321,-0.8072063012321,-0.8072063012321,-0.8072063012321,-0.8072063012321,-0.836745907348287,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625,-0.86451682717625],"text":["object[[1L]]:  289.00<br />object[[\"yhat\"]]: -0.8072063","object[[1L]]:  365.08<br />object[[\"yhat\"]]: -0.8072063","object[[1L]]:  441.16<br />object[[\"yhat\"]]: -0.8072063","object[[1L]]:  517.24<br />object[[\"yhat\"]]: -0.8072063","object[[1L]]:  593.32<br />object[[\"yhat\"]]: -0.8072063","object[[1L]]:  669.40<br />object[[\"yhat\"]]: -0.8072063","object[[1L]]:  745.48<br />object[[\"yhat\"]]: -0.8367459","object[[1L]]:  821.56<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]:  897.64<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]:  973.72<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1049.80<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1125.88<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1201.96<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1278.04<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1354.12<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1430.20<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1506.28<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1582.36<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1658.44<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1734.52<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1810.60<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1886.68<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 1962.76<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2038.84<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2114.92<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2191.00<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2267.08<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2343.16<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2419.24<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2495.32<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2571.40<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2647.48<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2723.56<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2799.64<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2875.72<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 2951.80<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3027.88<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3103.96<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3180.04<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3256.12<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3332.20<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3408.28<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3484.36<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3560.44<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3636.52<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3712.60<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3788.68<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3864.76<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 3940.84<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 4016.92<br />object[[\"yhat\"]]: -0.8645168","object[[1L]]: 4093.00<br />object[[\"yhat\"]]: -0.8645168"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":54.7945205479452},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[98.8,4283.2],"tickmode":"array","ticktext":["1000","2000","3000","4000"],"tickvals":[1000,2000,3000,4000],"categoryorder":"array","categoryarray":["1000","2000","3000","4000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"age_produit","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.867382353473457,-0.804340774934892],"tickmode":"array","ticktext":["-0.86","-0.84","-0.82"],"tickvals":[-0.86,-0.84,-0.82],"categoryorder":"array","categoryarray":["-0.86","-0.84","-0.82"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"yhat","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"42ac45ec774":{"x":{},"y":{},"type":"scatter"}},"cur_data":"42ac45ec774","visdat":{"42ac45ec774":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="variables-catégorielles-ou-binaires" class="section level3">
<h3>Variables catégorielles ou binaires</h3>
<pre class="r"><code>plot.gbm(model,&quot;PAYS&quot;)</code></pre>
<p><img src="churn_gbm_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code>plot.gbm(model,&quot;SEXE&quot;)</code></pre>
<p><img src="churn_gbm_files/figure-html/unnamed-chunk-14-2.png" width="672" /></p>
<pre class="r"><code>plot.gbm(model,&quot;MEMBRE_ACTIF&quot;)</code></pre>
<p><img src="churn_gbm_files/figure-html/unnamed-chunk-14-3.png" width="672" /></p>
<pre class="r"><code>plot.gbm(model,&quot;NB_PRODUITS&quot;)</code></pre>
<p><img src="churn_gbm_files/figure-html/unnamed-chunk-14-4.png" width="672" /></p>
<pre class="r"><code>plot.gbm(model,&quot;CARTE_CREDIT&quot;)</code></pre>
<p><img src="churn_gbm_files/figure-html/unnamed-chunk-14-5.png" width="672" /></p>
</div>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>On arrive assez facilement à une AUC-ROC de 84%, en augmentant la profondeur on peut arriver à 86% mais on risque du sur-apprentissage et des modèles plus difficiles à interpréter.</p>
<p>On comprend assez bien pourquoi un modèle linéaire a du mal à bien prédire, l’effet marginal de l’âge sur le churn a une forme très lissée de parabole concave. L’ajout des variables age^2 et age^3 peut aider mais ne permet pas d’atteindre les mêmes perfs.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
