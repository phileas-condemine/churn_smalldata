<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Philéas Condemine" />


<title>Modélisation du Churn sur un petit échantillon par Gradient Boosting</title>

<script src="site_libs/header-attrs-2.6/header-attrs.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="site_libs/datatables-binding-0.17/datatables.js"></script>
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<script src="site_libs/plotly-binding-4.9.3/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotly-main-1.57.1/plotly-latest.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Basic use of Gradient Boosting on a small sample of Bank Churn Data</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Modélisation du Churn sur un petit échantillon par Gradient Boosting</h1>
<h4 class="author">Philéas Condemine</h4>
<h4 class="date">17/03/2021</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#chargement-des-packages">Chargement des packages</a></li>
<li><a href="#lecture-des-données-et-consolidation">Lecture des données et consolidation</a></li>
<li><a href="#data-prep-basique">Data-prep basique</a></li>
<li><a href="#anticipation-définition-des-variables-ayant-un-effet-monotone">Anticipation : définition des variables ayant un effet monotone</a></li>
<li><a href="#fonction-pour-lancer-le-modèle-sur-un-échantillon-90-10">Fonction pour lancer le modèle sur un échantillon 90-10</a></li>
<li><a href="#fonction-pour-lancer-10-modèles-et-calculer-les-métriques">Fonction pour lancer 10 modèles et calculer les métriques</a></li>
<li><a href="#quelques-jeux-de-paramètres">Quelques jeux de paramètres</a>
<ul>
<li><a href="#sans-contrainte-de-monotonie">Sans contrainte de monotonie</a></li>
<li><a href="#effet-croissant-du-salaire">Effet croissant du salaire</a></li>
<li><a href="#profondeur-2">Profondeur 2</a></li>
<li><a href="#profondeur-4">Profondeur 4</a></li>
</ul></li>
<li><a href="#interprétation">Interprétation</a>
<ul>
<li><a href="#modèle-sur-toutes-les-données">Modèle sur toutes les données</a></li>
<li><a href="#importance-des-variables">Importance des variables</a></li>
</ul></li>
<li><a href="#dépendances-partielles">Dépendances partielles</a>
<ul>
<li><a href="#variables-numériques">Variables numériques</a></li>
<li><a href="#variables-catégorielles-ou-binaires">Variables catégorielles ou binaires</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</div>

<div id="chargement-des-packages" class="section level2">
<h2>Chargement des packages</h2>
<pre class="r"><code>library(data.table)
library(gbm)
library(caret)
library(dplyr)
library(MLmetrics)
library(plotly)
library(pdp)</code></pre>
</div>
<div id="lecture-des-données-et-consolidation" class="section level2">
<h2>Lecture des données et consolidation</h2>
<pre class="r"><code>customers = fread(&quot;data/customers.csv&quot;,encoding = &quot;UTF-8&quot;)
indicators = fread(&quot;data/indicators.csv&quot;,encoding = &quot;UTF-8&quot;)

uniqueN(indicators$ID_CLIENT)#On a 9950 individus avec 1 individu par ligne.</code></pre>
<pre><code>## [1] 9950</code></pre>
<pre class="r"><code>uniqueN(customers$ID_CLIENT)</code></pre>
<pre><code>## [1] 9950</code></pre>
<pre class="r"><code>dt = merge(customers,indicators,by=&quot;ID_CLIENT&quot;)
rm(customers,indicators)

dt = dt[,-c(&quot;ID_CLIENT&quot;,&quot;NOM&quot;)]
DT::datatable(head(dt,100)%&gt;%sapply(sample))#on permute les données par colonne parce que la diffusion n&#39;est pas autorisée. Ainsi on peut se faire une idée du contenu des colonnes sans révéler les données sous-jacentes.</code></pre>
<div id="htmlwidget-7329c1e3371952257f0f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7329c1e3371952257f0f">{"x":{"filter":"none","data":[["2014-04-01 00:00:00","2018-04-01 00:00:00","2010-02-01 00:00:00","2018-01-01 00:00:00","2013-06-01 00:00:00","2012-01-01 00:00:00","2016-05-01 00:00:00","2016-05-01 00:00:00","2013-05-01 00:00:00","2012-02-01 00:00:00","2015-06-01 00:00:00","2017-02-01 00:00:00","2020-01-01 00:00:00","2015-06-01 00:00:00","2011-03-01 00:00:00","2018-03-01 00:00:00","2013-01-01 00:00:00","2013-03-01 00:00:00","2013-06-01 00:00:00","2013-02-01 00:00:00","2014-03-01 00:00:00","2011-06-01 00:00:00","2011-01-01 00:00:00","2018-04-01 00:00:00","2013-02-01 00:00:00","2012-06-01 00:00:00","2016-06-01 00:00:00","2016-05-01 00:00:00","2014-04-01 00:00:00","2013-04-01 00:00:00","2019-01-01 00:00:00","2020-05-01 00:00:00","2019-01-01 00:00:00","2016-06-01 00:00:00","2018-04-01 00:00:00","2017-04-01 00:00:00","2018-04-01 00:00:00","2011-04-01 00:00:00","2012-02-01 00:00:00","2015-06-01 00:00:00","2010-01-01 00:00:00","2012-01-01 00:00:00","2011-06-01 00:00:00","2017-03-01 00:00:00","2014-04-01 00:00:00","2014-06-01 00:00:00","2013-02-01 00:00:00","2012-01-01 00:00:00","2016-03-01 00:00:00","2014-06-01 00:00:00","2012-06-01 00:00:00","2019-04-01 00:00:00","2019-04-01 00:00:00","2017-03-01 00:00:00","2015-06-01 00:00:00","2020-03-01 00:00:00","2011-02-01 00:00:00","2015-01-01 00:00:00","2012-02-01 00:00:00","2018-03-01 00:00:00","2012-06-01 00:00:00","2017-01-01 00:00:00","2015-06-01 00:00:00","2017-05-01 00:00:00","2014-01-01 00:00:00","2017-04-01 00:00:00","2011-01-01 00:00:00","2016-05-01 00:00:00","2013-01-01 00:00:00","2011-04-01 00:00:00","2012-01-01 00:00:00","2010-04-01 00:00:00","2017-02-01 00:00:00","2017-01-01 00:00:00","2020-04-01 00:00:00","2017-02-01 00:00:00","2019-02-01 00:00:00","2012-01-01 00:00:00","2019-01-01 00:00:00","2015-06-01 00:00:00","2015-01-01 00:00:00","2014-04-01 00:00:00","2010-06-01 00:00:00","2011-04-01 00:00:00","2010-03-01 00:00:00","2016-01-01 00:00:00","2012-05-01 00:00:00","2013-02-01 00:00:00","2018-01-01 00:00:00","2013-05-01 00:00:00","2019-06-01 00:00:00","2011-01-01 00:00:00","2017-01-01 00:00:00","2019-04-01 00:00:00","2015-01-01 00:00:00","2015-04-01 00:00:00","2011-04-01 00:00:00","2013-04-01 00:00:00","2018-03-01 00:00:00","2014-05-01 00:00:00"],["Espagne","Espagne","France","Allemagne","Allemagne","Espagne","Espagne","Allemagne","Allemagne","France","Espagne","France","Allemagne","Espagne","Espagne","Espagne","Allemagne","France","Espagne","France","France","France","Espagne","France","France","France","Espagne","France","Allemagne","France","Allemagne","Allemagne","Allemagne","France","France","France","France","France","France","France","France","France","France","France","France","Allemagne","Espagne","Allemagne","France","Espagne","Allemagne","France","France","France","France","Allemagne","Espagne","France","France","Allemagne","France","France","Allemagne","France","France","Espagne","Espagne","France","Allemagne","Espagne","France","Allemagne","France","Allemagne","Espagne","Espagne","Allemagne","Allemagne","France","France","France","Allemagne","Allemagne","Espagne","France","France","Espagne","Allemagne","Allemagne","Allemagne","Allemagne","Allemagne","Espagne","Allemagne","Espagne","Espagne","Allemagne","France","Espagne","Espagne"],["F","F","F","H","H","H","F","F","F","F","H","H","H","H","H","H","H","H","F","F","F","H","H","F","F","F","F","F","F","F","H","F","H","H","F","F","H","H","F","H","H","F","H","F","F","F","F","F","F","H","F","F","H","H","F","F","F","H","H","F","H","F","H","F","F","H","H","F","H","F","H","F","H","F","F","H","F","H","H","H","H","H","H","H","H","H","H","H","F","H","H","F","H","H","F","F","H","F","H","H"],["29","33","34","51","31","35","45","37","41","37","38","30","51","46","31","25","43","33","49","44","42","41","32","36","47","34","55","39","44","23","44","24","42","46","39","73","29","44","64","26","34","45","45","40","75","35","42","40","20","32","41","35","44","135","28","42","37","41","66","46","54","44","30","20","33","36","46","39","31","39","43","27","38","38","28","30","53","48","33","39","23","30","41","24","44","27","40","42","39","44","41","38","31","30","33","37","32","22","48","28"],["Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","No","Yes","Yes","No","No","Yes","No","No","Yes","No","Yes","Yes","No","No","No","No","Yes","No","Yes","Yes","No","Yes","Yes","Yes","No","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","No","No","No","Yes","No","Yes","No","Yes","No","No","Yes","No","No","Yes","Yes","Yes","Yes","Yes","Yes","No","No","No","Yes","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","No","No","Yes","Yes","No","No","Yes","No","No","No","Yes","Yes","Yes"],["0","137817.52","144164.29","0","144027.8","0","100727.5","0","0","0","161993.89","105918.1","144880.34","0","66201.96","0","0","64430.06","155059.1","0","139840.36","0","134766.85","77168.87","114631.23","109558.36","0","129991.76","102630.13","0","103560.57","129387.94","119278.01","167735.69","114940.67","133636.16","0","123040.38","134874.4","69609.85","137851.31","189318.16","143391.07","0","0","167557.12","0","106434.94","57809.32","0","0","83739.32","0","53573.18","0","0","0","0","111574.41","100275.88","0","127320.36","80542.81","124213.36","0","0","0","108913.84","98009.13","0","0","0","96048.55","66948.67","118894.22","114354.95","141535.52","52016.08","0","71497.79","0","0","88594.93","128243.03","0","138053.79","145578.28","0","81710.46","138171.1","96652.86","88046.88","163714.52","0","177997.07","132725.1","71379.53","143006.7","0","124616.23"],["1","4","1","2","2","2","2","1","1","1","2","1","2","2","1","1","2","2","3","1","2","2","3","1","1","1","1","2","1","2","1","2","1","1","2","2","1","1","1","1","1","1","1","1","1","2","2","1","2","1","1","1","2","2","2","1","2","2","1","1","1","2","2","1","1","2","2","2","2","2","3","1","2","2","2","1","1","2","1","1","1","1","2","15","1","2","2","1","2","2","2","2","1","2","2","1","2","1","2","2"],["No","Yes","Yes","Yes","Yes","No","Yes","No","Yes","Yes","No","No","No","Yes","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","No","No","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","Yes","No","No","Yes","No"],["98686.4","71709.12","163170.32",null,"140857.76","144584.29","79458.12","94739.2","62627.55","46041.08","88729.22","5008.23","76503.06","72993.65","147955.91","158646.46","120250.58","116520.07",null,"2923.61","183515.13","90212.38","48963.59","127433.47","197963.46","69320.97","51711.57","186172.85","16246.59","104665.79","79355.87","96123.72","175643.44","148798.45","161653.5","107124.17","6123.15","140759.03","15650.89","149665.65","189016.24","81908.09","74510.65","113469.65","114283.33","34948.77","41183.02","54018.93","81602.02","164549.74","175480.93","118825.56","140460.01","19233.41","35600.25","236.45","194895.57","137995.66","146891.07","108731.02","103315.74","154000.99","91429.74","56214.09","122604.44","162697.93","148779.41","101039.53","30583.95","56185.98","19370.73","66393.89","190040.29","45026.23","151083.8","47307.9","62830.97","83997.79","27862.58","30838.51","30804.68","163524.7","178997.89","186942.49","154639.72","31384.86","50595.15","188258.49","129590.18","83256.26","146700.22","96517.97","188203.58","1276.87","116747.62","77475.73","170333.38","39382.06","11631.34","72127.83"],["596","618","623","773","488","554","670","584","574","569","734","704","550","777","745","556","690",null,"749","580","656","601","515","532","683","766","646","492","712","698","735","548","738","587","527","633","586","616","656","802","592","627","487","450","698","661","573","667","709","612","537","681","809","481","794","430","653","634","738","660","634","787","793","497","709","508","598","630","761","559","719","653","581","501","779","633","749","678","850","712","758",null,"684","757","535","545","637","689","828","789",null,"631",null,"573","586","444",null,"739","650","601"],["Yes","Yes","No","No","Yes","No","Yes","No","No","No","No","No","No","No","No","No","Yes","Yes","No","No","No","No","Yes","Yes","No","No","No","No","No","No","No","Yes","No","No","No","No","No","No","Yes","No","No","No","No","No","No","No","No","No","No","No","No","No","No","Yes","No","No","No","Yes","No","No","No","Yes","No","Yes","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","Yes","No","No","Yes","No","No","No","No","Yes","No","No","No","Yes","No","No","No","No","No","No","Yes"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>DATE_ENTREE<\/th>\n      <th>PAYS<\/th>\n      <th>SEXE<\/th>\n      <th>AGE<\/th>\n      <th>MEMBRE_ACTIF<\/th>\n      <th>BALANCE<\/th>\n      <th>NB_PRODUITS<\/th>\n      <th>CARTE_CREDIT<\/th>\n      <th>SALAIRE<\/th>\n      <th>SCORE_CREDIT<\/th>\n      <th>CHURN<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="data-prep-basique" class="section level2">
<h2>Data-prep basique</h2>
<pre class="r"><code>dt[,DATE_ENTREE:=as.Date(DATE_ENTREE)]
{ggplot(data=dt)+geom_bar(aes(x=year(DATE_ENTREE)))}%&gt;%ggplotly</code></pre>
<div id="htmlwidget-deef9a35953aa12425f8" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-deef9a35953aa12425f8">{"x":{"data":[{"orientation":"v","width":[0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091],"base":[0,0,0,0,0,0,0,0,0,0,0],"x":[2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020],"y":[488,978,1017,1023,964,1008,986,1006,1039,1030,411],"text":["count:  488<br />year(DATE_ENTREE): 2010","count:  978<br />year(DATE_ENTREE): 2011","count: 1017<br />year(DATE_ENTREE): 2012","count: 1023<br />year(DATE_ENTREE): 2013","count:  964<br />year(DATE_ENTREE): 2014","count: 1008<br />year(DATE_ENTREE): 2015","count:  986<br />year(DATE_ENTREE): 2016","count: 1006<br />year(DATE_ENTREE): 2017","count: 1039<br />year(DATE_ENTREE): 2018","count: 1030<br />year(DATE_ENTREE): 2019","count:  411<br />year(DATE_ENTREE): 2020"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":48.9497716894977},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[2009.005,2020.995],"tickmode":"array","ticktext":["2010.0","2012.5","2015.0","2017.5","2020.0"],"tickvals":[2010,2012.5,2015,2017.5,2020],"categoryorder":"array","categoryarray":["2010.0","2012.5","2015.0","2017.5","2020.0"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"year(DATE_ENTREE)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-51.95,1090.95],"tickmode":"array","ticktext":["0","250","500","750","1000"],"tickvals":[0,250,500,750,1000],"categoryorder":"array","categoryarray":["0","250","500","750","1000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"42ac1f6a7806":{"x":{},"type":"bar"}},"cur_data":"42ac1f6a7806","visdat":{"42ac1f6a7806":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>dt[,age_produit:=as.numeric(Sys.Date() - DATE_ENTREE)]

dt = dt[,-c(&quot;DATE_ENTREE&quot;)]
dt[,id:=1:nrow(dt)]
dt[,group:=sample(1:10,replace=T,nrow(dt))]
dt[,CHURN:=ifelse(CHURN==&quot;Yes&quot;,1,0)]
dt = dt%&gt;%mutate_if(is.character,factor)%&gt;%data.table
#vars not needed in the model
useless = c(&quot;id&quot;,&quot;group&quot;)</code></pre>
</div>
<div id="anticipation-définition-des-variables-ayant-un-effet-monotone" class="section level2">
<h2>Anticipation : définition des variables ayant un effet monotone</h2>
<p>On verra après avoir lancé le modèle, en affichant les courbes de dépendance partielle que l’effet salaire est faible et instable avec un risque d’overfitting, ça se passe mieux si on met une contrainte de croissance.</p>
<pre class="r"><code>vars = names(dt)
vars = setdiff(vars,&quot;CHURN&quot;)
vars = setdiff(vars,useless)
monotony = setNames(rep(0,length(vars)),vars)
monotony[&#39;SALAIRE&#39;]=1
monotony</code></pre>
<pre><code>##         PAYS         SEXE          AGE MEMBRE_ACTIF 
##            0            0            0            0 
##      BALANCE  NB_PRODUITS CARTE_CREDIT      SALAIRE 
##            0            0            0            1 
## SCORE_CREDIT  age_produit 
##            0            0</code></pre>
</div>
<div id="fonction-pour-lancer-le-modèle-sur-un-échantillon-90-10" class="section level2">
<h2>Fonction pour lancer le modèle sur un échantillon 90-10</h2>
<pre class="r"><code>run_model_one_fold_and_predict = function(my_group,params,monotony){
  train = dt[!group %in% my_group]
  test = dt[group %in% my_group]
  
  model = gbm(data = train[,-useless,with=F],CHURN~.,
              distribution = &quot;bernoulli&quot;,
              var.monotone = monotony,
              n.trees = params[&#39;ntrees&#39;],verbose = F,
              train.fraction = .7,
              interaction.depth = params[&quot;depth&quot;],
              n.minobsinnode = params[&quot;nobs_in_node&quot;],
              shrinkage = params[&#39;shrinkage&#39;]
  )
  best.iter &lt;- suppressMessages({gbm.perf(model, method = &quot;OOB&quot;,plot.it = F,oobag.curve = F,overlay = F)})
  # print(as.numeric(best.iter))
  pred = predict(model,test,type=&quot;response&quot;,n.trees = best.iter)
  quantile(pred,0:10/10)
  q80 = quantile(pred,.8)%&gt;%unname
  test$pred_prob = pred
  test$pred_val = 1*(pred &gt; q80)
  
  test
}</code></pre>
</div>
<div id="fonction-pour-lancer-10-modèles-et-calculer-les-métriques" class="section level2">
<h2>Fonction pour lancer 10 modèles et calculer les métriques</h2>
<pre class="r"><code>run_model_and_evaluate = function(params,monotony){
  res = lapply(1:10,run_model_one_fold_and_predict,params=params,monotony=monotony)
  res = rbindlist(res)
  precision = Precision(y_pred = res$pred_val,y_true = res$CHURN)
  acc = Accuracy(y_pred = res$pred_val,y_true = res$CHURN)
  recall = Recall(y_pred = res$pred_val,y_true = res$CHURN)
  auroc = MLmetrics::AUC(y_pred = res$pred_prob,y_true = res$CHURN)
  c(params,&quot;precision&quot;=precision,&quot;recall&quot;=recall,&quot;acc&quot;=acc,&quot;auroc&quot;=auroc)
}</code></pre>
</div>
<div id="quelques-jeux-de-paramètres" class="section level2">
<h2>Quelques jeux de paramètres</h2>
<div id="sans-contrainte-de-monotonie" class="section level3">
<h3>Sans contrainte de monotonie</h3>
<pre class="r"><code>monotony[&#39;SALAIRE&#39;]=0
params = c(&quot;depth&quot;=1,&quot;nobs_in_node&quot;=20,&quot;shrinkage&quot;=.1,&quot;ntrees&quot;=200)
run_model_and_evaluate(params,monotony)</code></pre>
<pre><code>##        depth nobs_in_node    shrinkage       ntrees 
##    1.0000000   20.0000000    0.1000000  200.0000000 
##    precision       recall          acc        auroc 
##    0.8955768    0.8995330    0.8364824    0.8450705</code></pre>
</div>
<div id="effet-croissant-du-salaire" class="section level3">
<h3>Effet croissant du salaire</h3>
<pre class="r"><code>monotony[&#39;SALAIRE&#39;]=1
params = c(&quot;depth&quot;=1,&quot;nobs_in_node&quot;=20,&quot;shrinkage&quot;=.1,&quot;ntrees&quot;=200)
run_model_and_evaluate(params,monotony)</code></pre>
<pre><code>##        depth nobs_in_node    shrinkage       ntrees 
##    1.0000000   20.0000000    0.1000000  200.0000000 
##    precision       recall          acc        auroc 
##    0.8950741    0.8990281    0.8356784    0.8452095</code></pre>
</div>
<div id="profondeur-2" class="section level3">
<h3>Profondeur 2</h3>
<pre class="r"><code>params = c(&quot;depth&quot;=2,&quot;nobs_in_node&quot;=10,&quot;shrinkage&quot;=.1,&quot;ntrees&quot;=200)
run_model_and_evaluate(params,monotony)</code></pre>
<pre><code>##        depth nobs_in_node    shrinkage       ntrees 
##    2.0000000   10.0000000    0.1000000  200.0000000 
##    precision       recall          acc        auroc 
##    0.9009926    0.9050865    0.8452261    0.8586001</code></pre>
</div>
<div id="profondeur-4" class="section level3">
<h3>Profondeur 4</h3>
<pre class="r"><code>params = c(&quot;depth&quot;=4,&quot;nobs_in_node&quot;=10,&quot;shrinkage&quot;=.1,&quot;ntrees&quot;=200)
run_model_and_evaluate(params,monotony)</code></pre>
<pre><code>##        depth nobs_in_node    shrinkage       ntrees 
##    4.0000000   10.0000000    0.1000000  200.0000000 
##    precision       recall          acc        auroc 
##    0.9019854    0.9059700    0.8467337    0.8588292</code></pre>
</div>
</div>
<div id="interprétation" class="section level2">
<h2>Interprétation</h2>
<div id="modèle-sur-toutes-les-données" class="section level3">
<h3>Modèle sur toutes les données</h3>
<pre class="r"><code>params = c(&quot;depth&quot;=1,&quot;nobs_in_node&quot;=20,&quot;shrinkage&quot;=.1,&quot;ntrees&quot;=200)
useless = c(&quot;id&quot;,&quot;group&quot;)
train = dt[,-useless,with=F]


model = gbm(data = train,CHURN~.,
            distribution = &quot;bernoulli&quot;,
            var.monotone = monotony,
            n.trees = params[&#39;ntrees&#39;],verbose = F,
            train.fraction = .7,
            interaction.depth = params[&quot;depth&quot;],
            n.minobsinnode = params[&quot;nobs_in_node&quot;],
            shrinkage = params[&#39;shrinkage&#39;]
)
best.iter &lt;- suppressMessages({gbm.perf(model, method = &quot;OOB&quot;,plot.it = F,oobag.curve = F,overlay = F)})
# best.iter</code></pre>
</div>
<div id="importance-des-variables" class="section level3">
<h3>Importance des variables</h3>
<pre class="r"><code>summary(model)</code></pre>
<p><img src="churn_gbm_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre><code>##                       var    rel.inf
## AGE                   AGE 45.2306358
## NB_PRODUITS   NB_PRODUITS 31.2640936
## PAYS                 PAYS  7.4736948
## MEMBRE_ACTIF MEMBRE_ACTIF  7.4311385
## SEXE                 SEXE  2.5169904
## BALANCE           BALANCE  2.3776923
## SALAIRE           SALAIRE  1.8752356
## SCORE_CREDIT SCORE_CREDIT  1.6282506
## age_produit   age_produit  0.2022683
## CARTE_CREDIT CARTE_CREDIT  0.0000000</code></pre>
</div>
</div>
<div id="dépendances-partielles" class="section level2">
<h2>Dépendances partielles</h2>
<p>L’examen des dépendances partielles est utile pour évaluer visuellement des risques d’overfitting.</p>
<div id="variables-numériques" class="section level3">
<h3>Variables numériques</h3>
<pre class="r"><code>pdply = function(varname){
  pdp &lt;- suppressWarnings({partial(model,varname,n.trees = best.iter,plot = T,plot.engine = &quot;ggplot2&quot;)})
  pdp %&gt;% ggplotly
}


pdply(&quot;AGE&quot;)</code></pre>
<pre><code>## Warning: Use of `object[[1L]]` is discouraged. Use
## `.data[[1L]]` instead.</code></pre>
<pre><code>## Warning: Use of `object[[&quot;yhat&quot;]]` is discouraged. Use
## `.data[[&quot;yhat&quot;]]` instead.</code></pre>
<div id="htmlwidget-9171cdcdaf9de131f826" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-9171cdcdaf9de131f826">{"x":{"data":[{"x":[18,20,23,26,29,32,35,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83,86,89,92,94,97,100,103,106,109,112,115,118,121,124,127,130,133,136,139,142,145,148,151,154,157,160,163,166],"y":[-1.18960931936311,-1.18960931936311,-1.18960931936311,-1.18960931936311,-1.18960931936311,-1.18960931936311,-1.08179576462186,-1.02699587254373,-0.900943324172889,-0.50396545480752,-0.20397157928938,-0.0718045829124849,-0.0718045829124849,-0.0718045829124849,-0.0718045829124849,-0.202488214321589,-0.287595292077549,-0.560453259431478,-0.560453259431478,-0.949820818794351,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587,-1.02331854656587],"text":["object[[1L]]:  18<br />object[[\"yhat\"]]: -1.18960932","object[[1L]]:  20<br />object[[\"yhat\"]]: -1.18960932","object[[1L]]:  23<br />object[[\"yhat\"]]: -1.18960932","object[[1L]]:  26<br />object[[\"yhat\"]]: -1.18960932","object[[1L]]:  29<br />object[[\"yhat\"]]: -1.18960932","object[[1L]]:  32<br />object[[\"yhat\"]]: -1.18960932","object[[1L]]:  35<br />object[[\"yhat\"]]: -1.08179576","object[[1L]]:  38<br />object[[\"yhat\"]]: -1.02699587","object[[1L]]:  41<br />object[[\"yhat\"]]: -0.90094332","object[[1L]]:  44<br />object[[\"yhat\"]]: -0.50396545","object[[1L]]:  47<br />object[[\"yhat\"]]: -0.20397158","object[[1L]]:  50<br />object[[\"yhat\"]]: -0.07180458","object[[1L]]:  53<br />object[[\"yhat\"]]: -0.07180458","object[[1L]]:  56<br />object[[\"yhat\"]]: -0.07180458","object[[1L]]:  59<br />object[[\"yhat\"]]: -0.07180458","object[[1L]]:  62<br />object[[\"yhat\"]]: -0.20248821","object[[1L]]:  65<br />object[[\"yhat\"]]: -0.28759529","object[[1L]]:  68<br />object[[\"yhat\"]]: -0.56045326","object[[1L]]:  71<br />object[[\"yhat\"]]: -0.56045326","object[[1L]]:  74<br />object[[\"yhat\"]]: -0.94982082","object[[1L]]:  77<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]:  80<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]:  83<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]:  86<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]:  89<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]:  92<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]:  94<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]:  97<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 100<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 103<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 106<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 109<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 112<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 115<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 118<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 121<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 124<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 127<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 130<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 133<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 136<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 139<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 142<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 145<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 148<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 151<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 154<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 157<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 160<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 163<br />object[[\"yhat\"]]: -1.02331855","object[[1L]]: 166<br />object[[\"yhat\"]]: -1.02331855"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":54.7945205479452},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[10.6,173.4],"tickmode":"array","ticktext":["40","80","120","160"],"tickvals":[40,80,120,160],"categoryorder":"array","categoryarray":["40","80","120","160"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"AGE","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.24549955618564,-0.0159143460899537],"tickmode":"array","ticktext":["-1.00","-0.75","-0.50","-0.25"],"tickvals":[-1,-0.75,-0.5,-0.25],"categoryorder":"array","categoryarray":["-1.00","-0.75","-0.50","-0.25"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"yhat","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"42ac2f8f6842":{"x":{},"y":{},"type":"scatter"}},"cur_data":"42ac2f8f6842","visdat":{"42ac2f8f6842":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>pdply(&quot;BALANCE&quot;)</code></pre>
<pre><code>## Warning: Use of `object[[1L]]` is discouraged. Use
## `.data[[1L]]` instead.

## Warning: Use of `object[[&quot;yhat&quot;]]` is discouraged. Use
## `.data[[&quot;yhat&quot;]]` instead.</code></pre>
<div id="htmlwidget-b3a0731963680f81dd6c" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-b3a0731963680f81dd6c">{"x":{"data":[{"x":[0,5017.9618,10035.9236,15053.8854,20071.8472,25089.809,30107.7708,35125.7326,40143.6944,45161.6562,50179.618,55197.5798,60215.5416,65233.5034,70251.4652,75269.427,80287.3888,85305.3506,90323.3124,95341.2742,100359.236,105377.1978,110395.1596,115413.1214,120431.0832,125449.045,130467.0068,135484.9686,140502.9304,145520.8922,150538.854,155556.8158,160574.7776,165592.7394,170610.7012,175628.663,180646.6248,185664.5866,190682.5484,195700.5102,200718.472,205736.4338,210754.3956,215772.3574,220790.3192,225808.281,230826.2428,235844.2046,240862.1664,245880.1282,250898.09],"y":[-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.850057322432608,-0.868463584991014,-0.886127788460567,-0.886127788460567,-0.886127788460567,-0.886127788460567,-0.886127788460567,-0.886127788460567,-0.836864042062214,-0.836864042062214,-0.836864042062214,-0.365601563821507,-0.365601563821507,-0.365601563821507,-0.365601563821507,-0.365601563821507,-0.365601563821507,-0.365601563821507,-0.365601563821507,-0.365601563821507,-0.365601563821507,-0.365601563821507,-0.365601563821507,-0.365601563821507],"text":["object[[1L]]:      0.000<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:   5017.962<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  10035.924<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  15053.885<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  20071.847<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  25089.809<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  30107.771<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  35125.733<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  40143.694<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  45161.656<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  50179.618<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  55197.580<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  60215.542<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  65233.503<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  70251.465<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  75269.427<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  80287.389<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  85305.351<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  90323.312<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]:  95341.274<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]: 100359.236<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]: 105377.198<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]: 110395.160<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]: 115413.121<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]: 120431.083<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]: 125449.045<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]: 130467.007<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]: 135484.969<br />object[[\"yhat\"]]: -0.8500573","object[[1L]]: 140502.930<br />object[[\"yhat\"]]: -0.8684636","object[[1L]]: 145520.892<br />object[[\"yhat\"]]: -0.8861278","object[[1L]]: 150538.854<br />object[[\"yhat\"]]: -0.8861278","object[[1L]]: 155556.816<br />object[[\"yhat\"]]: -0.8861278","object[[1L]]: 160574.778<br />object[[\"yhat\"]]: -0.8861278","object[[1L]]: 165592.739<br />object[[\"yhat\"]]: -0.8861278","object[[1L]]: 170610.701<br />object[[\"yhat\"]]: -0.8861278","object[[1L]]: 175628.663<br />object[[\"yhat\"]]: -0.8368640","object[[1L]]: 180646.625<br />object[[\"yhat\"]]: -0.8368640","object[[1L]]: 185664.587<br />object[[\"yhat\"]]: -0.8368640","object[[1L]]: 190682.548<br />object[[\"yhat\"]]: -0.3656016","object[[1L]]: 195700.510<br />object[[\"yhat\"]]: -0.3656016","object[[1L]]: 200718.472<br />object[[\"yhat\"]]: -0.3656016","object[[1L]]: 205736.434<br />object[[\"yhat\"]]: -0.3656016","object[[1L]]: 210754.396<br />object[[\"yhat\"]]: -0.3656016","object[[1L]]: 215772.357<br />object[[\"yhat\"]]: -0.3656016","object[[1L]]: 220790.319<br />object[[\"yhat\"]]: -0.3656016","object[[1L]]: 225808.281<br />object[[\"yhat\"]]: -0.3656016","object[[1L]]: 230826.243<br />object[[\"yhat\"]]: -0.3656016","object[[1L]]: 235844.205<br />object[[\"yhat\"]]: -0.3656016","object[[1L]]: 240862.166<br />object[[\"yhat\"]]: -0.3656016","object[[1L]]: 245880.128<br />object[[\"yhat\"]]: -0.3656016","object[[1L]]: 250898.090<br />object[[\"yhat\"]]: -0.3656016"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":48.9497716894977},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-12544.9045,263442.9945],"tickmode":"array","ticktext":["0","50000","100000","150000","200000","250000"],"tickvals":[0,50000,100000,150000,200000,250000],"categoryorder":"array","categoryarray":["0","50000","100000","150000","200000","250000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"BALANCE","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.91215409969252,-0.339575252589554],"tickmode":"array","ticktext":["-0.9","-0.8","-0.7","-0.6","-0.5","-0.4"],"tickvals":[-0.9,-0.8,-0.7,-0.6,-0.5,-0.4],"categoryorder":"array","categoryarray":["-0.9","-0.8","-0.7","-0.6","-0.5","-0.4"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"yhat","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"42ac236342a4":{"x":{},"y":{},"type":"scatter"}},"cur_data":"42ac236342a4","visdat":{"42ac236342a4":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>pdply(&quot;SALAIRE&quot;)</code></pre>
<pre><code>## Warning: Use of `object[[1L]]` is discouraged. Use
## `.data[[1L]]` instead.

## Warning: Use of `object[[&quot;yhat&quot;]]` is discouraged. Use
## `.data[[&quot;yhat&quot;]]` instead.</code></pre>
<div id="htmlwidget-3032aa961b8dfa60abdf" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-3032aa961b8dfa60abdf">{"x":{"data":[{"x":[11.58,4011.198,8010.816,12010.434,16010.052,20009.67,24009.288,28008.906,32008.524,36008.142,40007.76,44007.378,48006.996,52006.614,56006.232,60005.85,64005.468,68005.086,72004.704,76004.322,80003.94,84003.558,88003.176,92002.794,96002.412,100002.03,104001.648,108001.266,112000.884,116000.502,120000.12,123999.738,127999.356,131998.974,135998.592,139998.21,143997.828,147997.446,151997.064,155996.682,159996.3,163995.918,167995.536,171995.154,175994.772,179994.39,183994.008,187993.626,191993.244,195992.862,199992.48],"y":[-0.964002648158019,-0.897369378920371,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.862186745282577,-0.856016170643915,-0.847244119381661,-0.847244119381661,-0.847244119381661,-0.847244119381661,-0.847244119381661,-0.847244119381661,-0.847244119381661,-0.847244119381661,-0.847244119381661,-0.834910386838295,-0.834910386838295,-0.825580080916254,-0.825580080916254,-0.825580080916254,-0.825580080916254,-0.816258400418103,-0.816258400418103,-0.816258400418103,-0.816258400418103,-0.816258400418103,-0.816258400418103,-0.816258400418103,-0.816258400418103],"text":["object[[1L]]:     11.580<br />object[[\"yhat\"]]: -0.9640026","object[[1L]]:   4011.198<br />object[[\"yhat\"]]: -0.8973694","object[[1L]]:   8010.816<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  12010.434<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  16010.052<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  20009.670<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  24009.288<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  28008.906<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  32008.524<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  36008.142<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  40007.760<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  44007.378<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  48006.996<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  52006.614<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  56006.232<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  60005.850<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  64005.468<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  68005.086<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  72004.704<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  76004.322<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  80003.940<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  84003.558<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  88003.176<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  92002.794<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]:  96002.412<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]: 100002.030<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]: 104001.648<br />object[[\"yhat\"]]: -0.8621867","object[[1L]]: 108001.266<br />object[[\"yhat\"]]: -0.8560162","object[[1L]]: 112000.884<br />object[[\"yhat\"]]: -0.8472441","object[[1L]]: 116000.502<br />object[[\"yhat\"]]: -0.8472441","object[[1L]]: 120000.120<br />object[[\"yhat\"]]: -0.8472441","object[[1L]]: 123999.738<br />object[[\"yhat\"]]: -0.8472441","object[[1L]]: 127999.356<br />object[[\"yhat\"]]: -0.8472441","object[[1L]]: 131998.974<br />object[[\"yhat\"]]: -0.8472441","object[[1L]]: 135998.592<br />object[[\"yhat\"]]: -0.8472441","object[[1L]]: 139998.210<br />object[[\"yhat\"]]: -0.8472441","object[[1L]]: 143997.828<br />object[[\"yhat\"]]: -0.8472441","object[[1L]]: 147997.446<br />object[[\"yhat\"]]: -0.8349104","object[[1L]]: 151997.064<br />object[[\"yhat\"]]: -0.8349104","object[[1L]]: 155996.682<br />object[[\"yhat\"]]: -0.8255801","object[[1L]]: 159996.300<br />object[[\"yhat\"]]: -0.8255801","object[[1L]]: 163995.918<br />object[[\"yhat\"]]: -0.8255801","object[[1L]]: 167995.536<br />object[[\"yhat\"]]: -0.8255801","object[[1L]]: 171995.154<br />object[[\"yhat\"]]: -0.8162584","object[[1L]]: 175994.772<br />object[[\"yhat\"]]: -0.8162584","object[[1L]]: 179994.390<br />object[[\"yhat\"]]: -0.8162584","object[[1L]]: 183994.008<br />object[[\"yhat\"]]: -0.8162584","object[[1L]]: 187993.626<br />object[[\"yhat\"]]: -0.8162584","object[[1L]]: 191993.244<br />object[[\"yhat\"]]: -0.8162584","object[[1L]]: 195992.862<br />object[[\"yhat\"]]: -0.8162584","object[[1L]]: 199992.480<br />object[[\"yhat\"]]: -0.8162584"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":54.7945205479452},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-9987.465,209991.525],"tickmode":"array","ticktext":["0","50000","100000","150000","200000"],"tickvals":[0,50000,100000,150000,200000],"categoryorder":"array","categoryarray":["0","50000","100000","150000","200000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"SALAIRE","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.971389860545015,-0.808871188031107],"tickmode":"array","ticktext":["-0.96","-0.92","-0.88","-0.84"],"tickvals":[-0.96,-0.92,-0.88,-0.84],"categoryorder":"array","categoryarray":["-0.96","-0.92","-0.88","-0.84"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"yhat","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"42ac41eb783a":{"x":{},"y":{},"type":"scatter"}},"cur_data":"42ac41eb783a","visdat":{"42ac41eb783a":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>pdply(&quot;SCORE_CREDIT&quot;)</code></pre>
<pre><code>## Warning: Use of `object[[1L]]` is discouraged. Use
## `.data[[1L]]` instead.

## Warning: Use of `object[[&quot;yhat&quot;]]` is discouraged. Use
## `.data[[&quot;yhat&quot;]]` instead.</code></pre>
<div id="htmlwidget-237862772ed68e69502c" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-237862772ed68e69502c">{"x":{"data":[{"x":[350,360,370,380,390,400,410,420,430,440,450,460,470,480,490,500,510,520,530,540,550,560,570,580,590,600,610,620,630,640,650,660,670,680,690,700,710,720,730,740,750,760,770,780,790,800,810,820,830,840,850],"y":[-0.370316255074977,-0.370316255074977,-0.370316255074977,-0.370316255074977,-0.370316255074977,-0.370316255074977,-0.370316255074977,-0.47769477870905,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508,-0.854134859974508],"text":["object[[1L]]: 350<br />object[[\"yhat\"]]: -0.3703163","object[[1L]]: 360<br />object[[\"yhat\"]]: -0.3703163","object[[1L]]: 370<br />object[[\"yhat\"]]: -0.3703163","object[[1L]]: 380<br />object[[\"yhat\"]]: -0.3703163","object[[1L]]: 390<br />object[[\"yhat\"]]: -0.3703163","object[[1L]]: 400<br />object[[\"yhat\"]]: -0.3703163","object[[1L]]: 410<br />object[[\"yhat\"]]: -0.3703163","object[[1L]]: 420<br />object[[\"yhat\"]]: -0.4776948","object[[1L]]: 430<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 440<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 450<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 460<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 470<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 480<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 490<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 500<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 510<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 520<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 530<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 540<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 550<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 560<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 570<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 580<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 590<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 600<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 610<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 620<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 630<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 640<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 650<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 660<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 670<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 680<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 690<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 700<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 710<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 720<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 730<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 740<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 750<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 760<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 770<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 780<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 790<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 800<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 810<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 820<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 830<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 840<br />object[[\"yhat\"]]: -0.8541349","object[[1L]]: 850<br />object[[\"yhat\"]]: -0.8541349"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":48.9497716894977},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[325,875],"tickmode":"array","ticktext":["400","500","600","700","800"],"tickvals":[400,500,600,700,800],"categoryorder":"array","categoryarray":["400","500","600","700","800"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"SCORE_CREDIT","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.878325790219484,-0.34612532483],"tickmode":"array","ticktext":["-0.8","-0.7","-0.6","-0.5","-0.4"],"tickvals":[-0.8,-0.7,-0.6,-0.5,-0.4],"categoryorder":"array","categoryarray":["-0.8","-0.7","-0.6","-0.5","-0.4"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"yhat","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"42ac4c08b2":{"x":{},"y":{},"type":"scatter"}},"cur_data":"42ac4c08b2","visdat":{"42ac4c08b2":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>pdply(&quot;age_produit&quot;)</code></pre>
<pre><code>## Warning: Use of `object[[1L]]` is discouraged. Use
## `.data[[1L]]` instead.

## Warning: Use of `object[[&quot;yhat&quot;]]` is discouraged. Use
## `.data[[&quot;yhat&quot;]]` instead.</code></pre>
<div id="htmlwidget-1018bdb5603ab2b7cbe8" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1018bdb5603ab2b7cbe8">{"x":{"data":[{"x":[289,365.08,441.16,517.24,593.32,669.4,745.48,821.56,897.64,973.72,1049.8,1125.88,1201.96,1278.04,1354.12,1430.2,1506.28,1582.36,1658.44,1734.52,1810.6,1886.68,1962.76,2038.84,2114.92,2191,2267.08,2343.16,2419.24,2495.32,2571.4,2647.48,2723.56,2799.64,2875.72,2951.8,3027.88,3103.96,3180.04,3256.12,3332.2,3408.28,3484.36,3560.44,3636.52,3712.6,3788.68,3864.76,3940.84,4016.92,4093],"y":[-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.839862763925633,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.853740660799323,-0.87686022321702,-0.87686022321702,-0.87686022321702,-0.87686022321702,-0.87686022321702,-0.87686022321702,-0.87686022321702],"text":["object[[1L]]:  289.00<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]:  365.08<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]:  441.16<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]:  517.24<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]:  593.32<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]:  669.40<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]:  745.48<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]:  821.56<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]:  897.64<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]:  973.72<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]: 1049.80<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]: 1125.88<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]: 1201.96<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]: 1278.04<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]: 1354.12<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]: 1430.20<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]: 1506.28<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]: 1582.36<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]: 1658.44<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]: 1734.52<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]: 1810.60<br />object[[\"yhat\"]]: -0.8398628","object[[1L]]: 1886.68<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 1962.76<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2038.84<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2114.92<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2191.00<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2267.08<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2343.16<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2419.24<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2495.32<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2571.40<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2647.48<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2723.56<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2799.64<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2875.72<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 2951.80<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 3027.88<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 3103.96<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 3180.04<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 3256.12<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 3332.20<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 3408.28<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 3484.36<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 3560.44<br />object[[\"yhat\"]]: -0.8537407","object[[1L]]: 3636.52<br />object[[\"yhat\"]]: -0.8768602","object[[1L]]: 3712.60<br />object[[\"yhat\"]]: -0.8768602","object[[1L]]: 3788.68<br />object[[\"yhat\"]]: -0.8768602","object[[1L]]: 3864.76<br />object[[\"yhat\"]]: -0.8768602","object[[1L]]: 3940.84<br />object[[\"yhat\"]]: -0.8768602","object[[1L]]: 4016.92<br />object[[\"yhat\"]]: -0.8768602","object[[1L]]: 4093.00<br />object[[\"yhat\"]]: -0.8768602"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":54.7945205479452},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[98.8,4283.2],"tickmode":"array","ticktext":["1000","2000","3000","4000"],"tickvals":[1000,2000,3000,4000],"categoryorder":"array","categoryarray":["1000","2000","3000","4000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"age_produit","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.87871009618159,-0.838012890961063],"tickmode":"array","ticktext":["-0.87","-0.86","-0.85","-0.84"],"tickvals":[-0.87,-0.86,-0.85,-0.84],"categoryorder":"array","categoryarray":["-0.87","-0.86","-0.85","-0.84"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"yhat","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"42ac4a9b5312":{"x":{},"y":{},"type":"scatter"}},"cur_data":"42ac4a9b5312","visdat":{"42ac4a9b5312":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="variables-catégorielles-ou-binaires" class="section level3">
<h3>Variables catégorielles ou binaires</h3>
<pre class="r"><code>plot.gbm(model,&quot;PAYS&quot;)</code></pre>
<p><img src="churn_gbm_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre class="r"><code>plot.gbm(model,&quot;SEXE&quot;)</code></pre>
<p><img src="churn_gbm_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
<pre class="r"><code>plot.gbm(model,&quot;MEMBRE_ACTIF&quot;)</code></pre>
<p><img src="churn_gbm_files/figure-html/unnamed-chunk-17-3.png" width="672" /></p>
<pre class="r"><code>plot.gbm(model,&quot;NB_PRODUITS&quot;)</code></pre>
<p><img src="churn_gbm_files/figure-html/unnamed-chunk-17-4.png" width="672" /></p>
<pre class="r"><code>plot.gbm(model,&quot;CARTE_CREDIT&quot;)</code></pre>
<p><img src="churn_gbm_files/figure-html/unnamed-chunk-17-5.png" width="672" /></p>
</div>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>On arrive assez facilement à une AUC-ROC de 84%, en augmentant la profondeur on peut arriver à 86% mais on risque du sur-apprentissage et des modèles plus difficiles à interpréter.</p>
<p>On comprend assez bien pourquoi un modèle linéaire a du mal à bien prédire, l’effet marginal de l’âge sur le churn a une forme très lissée de parabole concave. L’ajout des variables age^2 et age^3 peut aider mais ne permet pas d’atteindre les mêmes perfs.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
